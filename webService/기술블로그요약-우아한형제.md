기술블로그 요약

우아한형제 기술블로그를 읽다가 개인적으로 유념해야 할 부분들이 있는 것 같아 요약 정리해본다.

-“잘못될 수 있는 것은 꼭 잘못되게 마련이다” 라는 의미입니다. 특정 개인의 재수있고 없음과는 상관없는 것이지요.
-어차피 잘못될 것이니 자포자기 하라는 의미가 아니라 잘못될 가능성이 있다고 생각된다면 미리미리 대비 해야 한다는 뜻.

## 1. 사용자 입력 검증하기
- 사용자는 실수한다. 사용자의 입력은 무조건 검증한다. 
- 첫째 UI에서 선검증해서 편리성을 높이고(이건 말 그대로 편리성을 위한 것입니다), 그리고 **서버측에서도** 올바른 범위의 값을 입력했는지 무조건 검증해야만 합니다. 서버측 검증이 안 된 것은 클라이언트에서 어떤 3중 4중 검증을 했더라도 그냥 검증이 안 된 것입니다. 
- 날짜 입력시 이런 오류가 자주 발생한다.

## 2. 모든 계산은 서버에서 해야하고, 파라미터로 넘어온 값은 무조건 검증해야한다.
- 사용자의 입력 유효성 검사는 항상 서버에서 해야하며, 특히 계산 로직은 사용자 편의를 위해 프론트에서 일시적으로 해서 보여줄 수는 있으나 최종 결과는 서버에서 재계산 해야 합니다. DB 조회 한 번 하는거 귀찮다고 안했다가 큰일 납니다.
* 쇼핑몰 서버에서 금액을 계산하고 유효성 검사도 했으나 PG사에 넘겨준 결제금액 파라미터의 유효성 검사를 하지 않아서 5000만원 짜리를 1만원으로 조작한 이야기 : Web 요청으로 다른 시스템으로 값을 넘기면 요청서버-응답서버간에 해당 데이터가 맞는지 유효성 검사를 해야합니다.
- 
## 3. 사용자의 요청에 의해 Query의 모든 조건이 사라지면 안 된다.

- 아래같은 쿼리 사용 지양
‘’’
String sql = "SELECT * FROM comments  WHERE 1=1 ";
if (productId != null) {
  sql += " AND productId = :productId";
}

if (username != null) {
  sql += " AND username = :username"
}

// 그후 쿼리 실행 및 결과 반환
‘’’

## 4. 성능 측정 없는 캐시 사용은 성능을 저해시킬 수 있으며 캐시 데이터 구조 변경을 조심스럽게 해야한다.
Memcached
/Redis 같은 원격 분산 캐시를 사용한다면 몇가지 주의할 점이 있었습니다.
원격 분산캐시는 네트워크 대역폭을 먹고 삽니다. 캐시에 너무 많은 데이터를 담으면 비록 캐시 히트율이 매우 높더라도 데이터가 네트워크 대역폭을 잡아먹어서 느려지게 됩니다.
따라서 실제 운영 서비스를 기준으로 성능 테스트를 하고 충분한 대역폭이 확보 돼 있는지 확인했어야 합니다.
또한 데이터의 크기가 너무 크다면, 압축 솔루션으로 전송량을 낮출 수도 있습니다.
하지만 이것도 문제가 있었습니다. 압축된 데이터를 풀고, 직렬화를 하는데 들어가는 CPU 점유율도 충분한지 테스트가 필요합니다. 이 경우는 그나마 낫다고 할 수 있습니다. 서버만 늘리면 되니까요.
- 그리고 원격 캐시 사용의 커다란 문제 하나가 더 남습니다. 직렬화시 데이터 포맷의 변경 체크문제 입니다.

## 출처
- http://woowabros.github.io/experience/2019/09/19/programmer-murphy-law.html


